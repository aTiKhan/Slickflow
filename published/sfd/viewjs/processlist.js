import slick from"../script/slick.event.js";import kconfig from"../config/kconfig.js";window.slick=slick;import ClipboardJS from"../script/clipboard.min.js";window.ClipboardJS=ClipboardJS;const processlist=function(){function e(){}return e.pselectedProcessEntity=null,e.mprocessTemplateType="",e.afterCreated=new slick.Event,e.afterOpened=new slick.Event,e.diagramCreated=new slick.Event,e.getProcessList=function(){jshelper.ajaxGet(kconfig.webApiUrl+"api/Wf2Xml/GetProcessListSimple",null,(function(t){if(1===t.Status){var s=document.querySelector("#myProcessGrid");$(s).empty();var r={columnDefs:[{headerName:"ID",field:"ID",width:80},{headerName:kresource.getItem("processguid"),field:"ProcessGUID",width:120},{headerName:kresource.getItem("processname"),field:"ProcessName",width:200},{headerName:kresource.getItem("version"),field:"Version",width:80},{headerName:kresource.getItem("processcode"),field:"ProcessCode",width:200},{headerName:kresource.getItem("packagetype"),field:"PackageType",width:80,cellRenderer:function(e){return 1===e.value?kresource.getItem("mainprocess"):2===e.value?kresource.getItem("poolprocess"):""}},{headerName:kresource.getItem("packageid"),field:"PackageID",width:80},{headerName:kresource.getItem("status"),field:"IsUsing",width:80,cellRenderer:function(e){return 1===e.value?kresource.getItem("active"):kresource.getItem("unactive")}},{headerName:kresource.getItem("starttype"),field:"StartType",width:80,cellRenderer:function(e){var t="";return 1===e.value?t=kresource.getItem("timer"):2===e.value&&(t=kresource.getItem("message")),t}},{headerName:kresource.getItem("startexpression"),field:"StartExpression",width:140},{headerName:kresource.getItem("endtype"),field:"EndType",width:80,cellRenderer:function(e){var t="";return 1===e.value?t=kresource.getItem("timer"):2===e.value&&(t=kresource.getItem("message")),t}},{headerName:kresource.getItem("endexpression"),field:"EndExpression",width:140},{headerName:kresource.getItem("createddatetime"),field:"CreatedDateTime",width:220}],rowSelection:"single",onSelectionChanged:function(){r.api.getSelectedRows().forEach((function(t,s){e.pselectedProcessEntity=t}))},onRowDoubleClicked:function(t,s){e.sure()}};new agGrid.Grid(s,r),r.api.setRowData(t.Entity),$("#loading-indicator").hide()}else kmsgbox.error(kresource.getItem("processlisterrormsg"))}))},e.createProcess=function(){e.pselectedProcessEntity=null,e.mProcessEditDialog=BootstrapDialog.show({message:$('<div id="popupContent-create"></div>'),title:kresource.getItem("processcreate"),onshown:function(){$("#popupContent-create").load("pages/process/edit.html")},draggable:!0})},e.loadProcess=function(){var t=e.pselectedProcessEntity;if(null!==t)$("#txtProcessGUID").val(t.ProcessGUID),$("#txtProcessName").val(t.ProcessName),$("#txtProcessCode").val(t.ProcessCode),$("#txtVersion").val(t.Version),$("#ddlIsUsing").val(t.IsUsing),$("#txtDescription").val(t.Description);else{var s=jshelper.getUUID();$("#txtProcessGUID").val(s),$("#txtProcessName").val(""),$("#txtProcessCode").val(""),$("#txtVersion").val("1"),$("#ddlIsUsing").val(),$("#txtDescription").val("")}},e.editProcess=function(){var t=e.pselectedProcessEntity;if(null===t)return kmsgbox.warn(kresource.getItem("processselectedwarnmsg")),!1;2===t.PackageType?kmsgbox.warn(kresource.getItem("processpoolopendiagramwarnmsg")):BootstrapDialog.show({message:$('<div id="popupContent-edit"></div>'),title:kresource.getItem("processedit"),onshown:function(){$("#popupContent-edit").load("pages/process/edit.html")},draggable:!0})},e.saveDiagram=function(){if(""===$.trim($("#txtProcessName").val())||""===$.trim($("#txtProcessCode").val())||""===$.trim($("#txtVersion").val()))return kmsgbox.warn(kresource.getItem("processsavewarnmsg")),!1;var t={ProcessGUID:kmain.mxSelectedProcessEntity.ProcessGUID,ProcessName:$("#txtProcessName").val(),ProcessCode:$("#txtProcessCode").val(),Version:$("#txtVersion").val(),IsUsing:$("#ddlIsUsing").val(),Description:$("#txtDescription").val()};processapi.checkProcessFile(t,(function(s){1===s.Status?null===s.Entity?processapi.create(t,!1,(function(s){1===s.Status&&(e.pselectedProcessEntity=s.Entity,slick.trigger(e.diagramCreated,{ProcessEntity:t}))})):kmsgbox.warn(kresource.getItem("processsavenotuniquewarnmsg")):kmsgbox.error(kresource.getItem("processcheckfileexisterrormsg"),s.Message)}))},e.upgradeProcess=function(){if(null===e.pselectedProcessEntity)return kmsgbox.warn(kresource.getItem("processselectedwarnmsg")),!1;kmsgbox.confirm(kresource.getItem("processupgrademsg"),(function(){var t={ID:e.pselectedProcessEntity.ID};processapi.upgrade(t)}))},e.updateUsingState=function(){if(null===e.pselectedProcessEntity)return kmsgbox.warn(kresource.getItem("processselectedwarnmsg")),!1;var t="",s=0;0===e.pselectedProcessEntity.IsUsing?(s=1,t=kresource.getItem("processusingenablemsg")):(s=0,t=kresource.getItem("processusingunablemsg")),kmsgbox.confirm(t,(function(){var t={ProcessGUID:e.pselectedProcessEntity.ProcessGUID,Version:e.pselectedProcessEntity.Version,IsUsing:s};processapi.updateUsingState(t)}))},e.refreshProcess=function(){e.getProcessList()},e.createFromTemplate=function(){if(""===$.trim($("#txtProcessName").val())||""===$.trim($("#txtProcessCode").val())||""===$.trim($("#txtVersion").val()))return kmsgbox.warn(kresource.getItem("processsavewarnmsg")),!1;var t={ProcessGUID:$("#txtProcessGUID").val(),ProcessName:$("#txtProcessName").val(),ProcessCode:$("#txtProcessCode").val(),Version:$("#txtVersion").val(),IsUsing:$("#ddlIsUsing").val(),Description:$("#txtDescription").val(),TemplateType:""===e.mprocessTemplateType?"Blank":e.mprocessTemplateType};null===e.pselectedProcessEntity?processapi.checkProcessFile(t,(function(s){1===s.Status?null===s.Entity?processapi.create(t,!0,(function(t){1===t.Status&&(e.pselectedProcessEntity=t.Entity,kmain.mxSelectedProcessEntity=t.Entity,e.afterOpened&&slick.trigger(e.afterOpened,{ProcessEntity:t.Entity}),void 0!==kmain.templateDialog&&kmain.templateDialog.close())})):kmsgbox.warn(kresource.getItem("processsavenotuniquewarnmsg")):kmsgbox.error(kresource.getItem("processcheckfileexisterrormsg"),s.Message)})):processapi.update(t)},e.deleteProcess=function(){var t=kresource.getItem("processdeletemsg");1===e.pselectedProcessEntity.PackageType&&(t=kresource.getItem("processpooldeletemsg")),kmsgbox.confirm(t,(function(){var t={ProcessGUID:e.pselectedProcessEntity.ProcessGUID,Version:e.pselectedProcessEntity.Version};processapi.delete(t)}))},e.sure=function(){var t,s=e.pselectedProcessEntity;null!==s&&(2===s.PackageType?kmsgbox.warn(kresource.getItem("processpoolopendiagramwarnmsg")):(t=s,e.afterOpened&&slick.trigger(e.afterOpened,{ProcessEntity:t})))},e.showXmlContent=function(){kmain.mBpmnModeler.saveXML({format:!0}).then((function(e){if(e&&e.xml){var t=e.xml;!1===$.isEmptyObject(t)?($("#txtXmlContent").val(t),(s=new ClipboardJS("#btnCopy")).on("success",(function(){})),s.on("error",(function(){kmsgbox.warn(kresource.getItem("xmlcopytoclipboardwarn"))}))):kmsgbox.warn(kresource.getItem("xmlpreviewwarnmsg"))}else kmsgbox.warn(kresource.getItem("xmlprevieexceptionmsg"),e.message);var s}))},e.initXmlImport=function(){new qq.FineUploader({element:document.getElementById("fine-uploader-validation"),template:"qq-template-validation",request:{endpoint:kconfig.webApiUrl+"api/FineUpload/import",params:{extraParam1:"1",extraParam2:"2"}},thumbnails:{placeholders:{waitingPath:"vendor/fine-uploader/fine-uploader/placeholders/waiting-generic.png",notAvailablePath:"vendor/fine-uploader/fine-uploader/placeholders/not_available-generic.png"}},validation:{allowedExtensions:["xml","txt"],itemLimit:1,sizeLimit:102400},callbacks:{onComplete:function(e,t,s){!0===s.success?kmsgbox.info(kresource.getItem("processxmlimportokmsg")):kmsgbox.error(kresource.getItem("processxmlimporterrormsg"),s.Message)}}})},e}();export default processlist;